<?php

namespace App\Http\Controllers;

use Illuminate\Support\Facades\DB;
use Illuminate\Routing\Controller as BaseController;
use App\Http\Utility\TimeUtility;

class VulnerabilityController extends BaseController
{
    static public function createVulReportBySensorAndHostIp($sensor, $host_ip) {
        $vul_report_id = DB::table('vul_reports')->insertGetId(
            [
                'sensor_id' => $sensor -> id,
                'host_ip' => $host_ip,
                'created_at' => TimeUtility::currentTimeStamp(),
                'updated_at' => TimeUtility::currentTimeStamp()
            ]
        );
        $vul_report = DB::table('vul_reports')->where('id', $vul_report_id)->first();
        return $vul_report;
    }

    static public function createVulReportRecordByRecordAndVulReportId($record, $vul_report_id) {
        $vul_report_record_id = DB::table('vul_report_records')->insertGetId(
            [
                'vul_report_id' => $vul_report_id,
                'service' => $record -> service,
                'vul_name' => $record -> vul_name,
                'cve_id' => $record -> cve_id,
                'description' => $record -> description,
                'severity' => $record -> severity,
                'created_at' => TimeUtility::currentTimeStamp(),
                'updated_at' => TimeUtility::currentTimeStamp()
            ]
        );
    }
}
